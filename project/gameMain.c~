#include <msp430.h>
#include <libTimer.h>
#include "lcdutils.h"
#include "lcddraw.h"
#include "switches.h"


void update_shape();
int BG_COLOR = COLOR_BLUE;
void main()
{
  P1DIR |= LED;/**< Green led on when CPU on */
  P1OUT |= LED;
  configureClocks();
  lcd_init();
  switch_init();
  enableWDTInterrupts();      /**< enable periodic interrupt */
  or_sr(0x8);              /**< GIE (enable interrupts) */
  clearScreen(BG_COLOR);
  while (1) {/* forever */
    if (redrawScreen) {
      redrawScreen = 0;
      update_shape();
    }
    P1OUT &= ~LED;/* led off */
    or_sr(0x10);/**< CPU OFF */
    P1OUT |= LED;/* led on */
  }
}

    
void update_shape()
{
  static unsigned char row = screenHeight / 2, col = screenWidth / 2;
  static char blue = 31, green = 0, red = 31;
  static unsigned char step = 0;
  static char state = 0;
  static char width= 30;
  // printf("Screen height is: %d\n",screenHeight);
  // printf("Screen width is: %d\n",screenWidth);
  if (switches & SW4) return;
  
//four corner appear/dissapear
  switch(state){
  case 0:
    clearScreen(COLOR_BLUE);
    fillRectangle(0,0,width,width,COLOR_RED);
    state = 1;
    break;
  case 1:
    clearScreen(COLOR_BLUE);
    fillRectangle(screenWidth-width,0,width,width,COLOR_RED);
    state = 2;
    break;
  case 2:
    clearScreen(COLOR_BLUE);
    fillRectangle(screenWidth-30,screenHeight-30,width,width,COLOR_RED);
    state = 3;
    break;
  case 3:
    clearScreen(COLOR_BLUE);
    fillRectangle(0,screenHeight-30,width,width,COLOR_RED);
    state = 0;
    break;
    }
      
  /*if (step <= 60) {
    int startCol = col - step;
    int endCol = col + step;
    int width = 1 + endCol - startCol;
    int startRow = row - step;
    int endRow = row + step;
    int height = 1 + endRow - startRow;
    // a color in this BGR encoding is BBBB BGGG GGGR RRRR
    unsigned int color = (blue << 11) | (green << 5) | red;
    //  fillRectangle(startCol,endRow,width,height,color);
    
    fillRectangle(startCol, row+step, width, 1, color);// top
    fillRectangle(startCol, row-step, width, 1, color);//bottom
    fillRectangle(startCol, row-step, 1, height, color);//left
    fillRectangle(endCol, row-step, 1, height, color);//right
    //drawString5x7(startCol,row,"-",COLOR_BLACK,color);
    if (switches & SW3) green = (green + 1) % 64;
    if (switches & SW2) blue = (blue + 2) % 32;
    if (switches & SW1) red = (red - 3) % 32;
    if (step <= 30){
      drawString5x7(10,10,"hello there",COLOR_BLACK,color);
    }
    if(step > 30){
       drawString5x7(10,10, "general Kenobi",COLOR_BLACK,color);
    }
    step ++;
  } else {
     clearScreen(COLOR_BLUE);
     step = 0;
  }*/
  /* 
  if(seconds < screenWidth){
    fillRectangle(0,0,width+seconds-1,width,COLOR_BLUE);
    fillRectangle(seconds+1,0,width,width,COLOR_RED);
    }*/
  
}
